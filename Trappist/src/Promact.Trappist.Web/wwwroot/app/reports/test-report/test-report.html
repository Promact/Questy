<div class="loader-container" *ngIf="loader">
    <div class="spinner"></div>
</div>
<div class="test-report">
    <div class="test-create-header clearfix" *ngIf="!loader">
        <div class="container">
            <h1 class="pull-left">
                <span class="test-name">{{test.testName}}</span>
            </h1>
            <div class="search-area pull-right mt5">
                <input type="text" placeholder="Search reports" [(ngModel)]="searchString" (keyup)="getTestAttendeeMatchingSearchCriteria(searchString)" [hidden]="!showSearchInput" (blur)="showStatus()" name="search" id="search" #search/>
                <button type="button" (click)="showSearchInput = true;;selectTextArea($event,search)"><i class="material-icons">search</i></button>
            </div>
        </div>
    </div>
    <div class="container" *ngIf="!isAnyCandidateExist">
        <div class="report-title-block clearfix">
            <div class="pull-left">
                <h2>Test Report</h2>
            </div>
            <a class="pull-right back-link" [routerLink]="['/tests']">< back</a>
        </div>
        <h5 *ngIf="!loader" class="mt20 mb20">No Record(s) Found.</h5>
    </div>
    <div class="container" *ngIf="isAnyCandidateExist">
        <div class="report-title-block clearfix">
            <div class="pull-left">
                <h2>Test Report</h2>
                <select class="form-control" [(ngModel)]="testCompletionStatus" (change)="setTestStatusType(testCompletionStatus)">
                    <option value="0">All Candidates ({{count}})</option>
                    <option value="1">Completed Test</option>
                    <option value="2">Expired Test</option>
                    <option value="3">Blocked Test</option>
                </select>
                <md-checkbox class="only-checkbox" (change)="showAllStarredCandidates()"> &nbsp; Show Starred Candidates &nbsp; </md-checkbox>
                <button type="button" class="btn" (click)="downloadTestReportExcel()">Download Excel</button>
                <button type="button" class="btn" (click)="downloadTestReportPdf()">Download PDF</button>
            </div>
            <a class="pull-right back-link mt10" [routerLink]="['/tests']">< back</a>
        </div>
        <div class="grid-container">
            <table class="data-grid" [md2Data]="testAttendeeArray" #report="md2DataTable" [rowsPerPage]="10" [(activePage)]="activePage">
                <thead>
                    <tr>
                        <th><md-checkbox class="only-checkbox" [(ngModel)]="checkedAllCandidate" (change)="selectAllCandidates()"></md-checkbox></th>
                        <th><em class="material-icons" [ngClass]="{starred : isAllCandidateStarred}" (click)="setAllCandidatesStarred()">{{headerStarStatus}}</em></th>
                        <th class="h5" md2SortBy="firstName">Name</th>
                        <th class="h5" md2SortBy="email">Email</th>
                        <th class="h5" md2SortBy="createdDateTime">Test Date</th>
                        <th class="h5" md2SortBy="report.totalMarksScored">Score</th>
                        <th class="h5" md2SortBy="report.percentage">Percentage</th>
                        <th class="h5" *ngIf="isAnyTestResume">Allow Resume?</th>
                        <th></th>
                        <th></th>
                    </tr>
                </thead>
                <tbody>
                    <tr *ngFor="let testAttendee of report.data;let i = index">
                        <td><md-checkbox class="only-checkbox" [(ngModel)]="testAttendee.checkedCandidate" (change)="selectIndividualCandidate(testAttendee,testAttendee.checkedCandidate)"></md-checkbox></td>
                        <td><em class="material-icons" [ngClass]="{starred : testAttendee.starredCandidate}" (click)="setStarredCandidate(testAttendee)">{{isStarredCandidate(testAttendee)}}</em></td>
                        <td class="theme-text font-semibold" [routerLink]="['individual-report/',testAttendee.id]"> {{testAttendee.firstName}} {{testAttendee.lastName}}</td>
                        <td [routerLink]="['individual-report/',testAttendee.id]">{{testAttendee.email}}</td>
                        <td id="date">{{testAttendee.createdDateTime |date:'fullDate'}}</td>
                        <td>{{testAttendee.report.totalMarksScored}}</td>
                        <td>{{testAttendee.report.percentage}}</td>
                        <td (click)="navigateTo(testAttendee.id)">Back to Test</td>
                        <td><em class="material-icons" [routerLink]="['individual-report/',testAttendee.id,'download']">file_download</em></td>
                        <td *ngIf="testAttendee.report.isTestPausedUnWillingly" (click)="resumeTest(testAttendee)"><a>Allow Resume Test</a></td>
                        
                        <td><a class="theme-text" *ngIf="testAttendee.report.isTestPausedUnWillingly" (click)="resumeTest(testAttendee)">Allow</a></td>
                        
                        <td class="text-right"><em class="material-icons" [routerLink]="['individual-report/',testAttendee.id]">remove_red_eye</em></td>
                    </tr>
                </tbody>
                <tfoot>
                    <tr>
                        <td colspan="4">
                            <span class="records-info">Showing {{startingIndexOfActivePage(activePage,count)}} to {{endingIndexOfActivePage(activePage,count)}} of {{count}} records </span>
                        </td>
                        <td colspan="5">
                            <md2-pagination></md2-pagination>
                        </td>
                    </tr>
                </tfoot>
            </table>
        </div>
    </div>
</div>
